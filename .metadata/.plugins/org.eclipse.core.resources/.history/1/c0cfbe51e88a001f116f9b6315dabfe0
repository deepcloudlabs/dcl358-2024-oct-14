package com.example.shipping.service;

import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Service;

import com.example.crm.event.CustomerEvent;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

@Service
public class CustomerReplicationService {
	private final ObjectMapper objectMapper;
	
	public CustomerReplicationService(ObjectMapper objectMapper) {
		this.objectMapper = objectMapper;
	}

	@KafkaListener(topics = { "${customerEventTopicName}" }, groupId = "shipping-service")
	public void listenCustomerEvents(String event) {
		System.out.println("new replication customer event has just arrived: %s".formatted(event));
		try {
			objectMapper.readValue(event, CustomerEvent.class);
		} catch (JsonProcessingException e) {
			System.out.println("Exception while deserializing the json: %s".formatted(e.getMessage()));
		}
	}
}
